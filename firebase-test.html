<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢–µ—Å—Ç Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-panel {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .status {
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      #log {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 15px;
        border-radius: 5px;
        max-height: 300px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <h1>üî• Firebase Connection Test</h1>

    <div class="test-panel">
      <h3>–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
      <div id="connectionStatus" class="status info">
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...
      </div>

      <h3>–¢–µ—Å—Ç—ã</h3>
      <button onclick="testFirebaseConnection()">
        –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Firebase
      </button>
      <button onclick="testAuthentication()">–¢–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</button>
      <button onclick="testDatabaseWrite()">–¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î</button>
      <button onclick="testDatabaseRead()">–¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è –∏–∑ –ë–î</button>
      <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>

      <h3>–õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
      <div id="log"></div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
      // Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
      const firebaseConfig = {
        apiKey: "ATZaEVeSSGtLRpQq7e_ZQKPjOZkRq-YRKOpSjE",
        authDomain: "my-bud≈ºet.firebaseapp.com",
        databaseURL:
          "https://my-bud≈ºet-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "my-bud≈ºet",
        storageBucket: "my-bud≈ºet.firebasestorage.app",
        messagingSenderId: "38303046323",
        appId: "1:38303046323:web:e60dbad863a6db92c6",
        measurementId: "G-3SWHMH2ZF8",
      };

      let app, auth, database;
      let currentUser = null;

      function log(message, type = "info") {
        const logElement = document.getElementById("log");
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${message}`;

        logElement.innerHTML += `<div style="color: ${
          type === "error" ? "red" : type === "success" ? "green" : "black"
        }">${logEntry}</div>`;
        logElement.scrollTop = logElement.scrollHeight;

        console.log(logEntry);
      }

      function updateStatus(message, type) {
        const statusElement = document.getElementById("connectionStatus");
        statusElement.textContent = message;
        statusElement.className = `status ${type}`;
      }

      async function testFirebaseConnection() {
        try {
          log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...", "info");

          if (!firebase.apps.length) {
            app = firebase.initializeApp(firebaseConfig);
            log("‚úÖ Firebase –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ", "success");
          } else {
            app = firebase.app();
            log("‚úÖ Firebase –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ", "success");
          }

          auth = firebase.auth();
          database = firebase.database();

          log("‚úÖ Firebase Auth –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω", "success");
          log("‚úÖ Firebase Realtime Database –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω", "success");

          updateStatus("Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ", "success");
        } catch (error) {
          log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Firebase: ${error.message}`, "error");
          updateStatus("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Firebase", "error");
        }
      }

      async function testAuthentication() {
        try {
          log("–¢–µ—Å—Ç –∞–Ω–æ–Ω–∏–º–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏...", "info");

          if (!auth) {
            log("‚ùå Firebase Auth –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω", "error");
            return;
          }

          const userCredential = await auth.signInAnonymously();
          currentUser = userCredential.user;

          log(
            `‚úÖ –ê–Ω–æ–Ω–∏–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞. User ID: ${currentUser.uid}`,
            "success"
          );
          updateStatus("–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ", "success");
        } catch (error) {
          log(`‚ùå –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: ${error.message}`, "error");
          updateStatus("–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏", "error");
        }
      }

      async function testDatabaseWrite() {
        try {
          if (!currentUser) {
            log("‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é", "error");
            return;
          }

          log("–¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –≤ Realtime Database...", "info");

          const testData = {
            data: {
              test: true,
              timestamp: new Date().toISOString(),
              message: "–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—é–¥–∂–µ—Ç–∞",
            },
            lastModified: firebase.database.ServerValue.TIMESTAMP,
            version: "1.0.0",
          };

          await database.ref(`budgets/${currentUser.uid}`).set(testData);
          log("‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Firebase", "success");
        } catch (error) {
          log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –ë–î: ${error.message}`, "error");
        }
      }

      async function testDatabaseRead() {
        try {
          if (!currentUser) {
            log("‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é", "error");
            return;
          }

          log("–¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è –∏–∑ Realtime Database...", "info");

          const snapshot = await database
            .ref(`budgets/${currentUser.uid}`)
            .once("value");

          if (snapshot.exists()) {
            const data = snapshot.val();
            log(
              `‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã: ${JSON.stringify(data, null, 2)}`,
              "success"
            );
          } else {
            log(
              "‚ÑπÔ∏è –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)",
              "info"
            );
          }
        } catch (error) {
          log(`‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∏–∑ –ë–î: ${error.message}`, "error");
        }
      }

      function clearLog() {
        document.getElementById("log").innerHTML = "";
      }

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      window.addEventListener("load", () => {
        log("–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞—á–∏–Ω–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç...", "info");
        setTimeout(testFirebaseConnection, 1000);
      });
    </script>
  </body>
</html>
