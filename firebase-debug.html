<!DOCTYPE html>
<html>
  <head>
    <title>Firebase Debug Test</title>
    <style>
      body {
        font-family: Arial;
        padding: 20px;
        background: #f0f0f0;
      }
      .log {
        padding: 8px;
        margin: 5px 0;
        border-radius: 4px;
        font-family: monospace;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      h1 {
        color: #333;
      }
    </style>
  </head>
  <body>
    <h1>üî• Firebase –û—Ç–ª–∞–¥–∫–∞</h1>
    <button onclick="checkFirebaseStep1()">1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Firebase SDK</button>
    <button onclick="checkFirebaseStep2()">2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é</button>
    <button onclick="checkFirebaseStep3()">3. –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
    <button onclick="runFullTest()">üöÄ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç</button>
    <div id="log"></div>

    <!-- Firebase CDN - —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–µ –∂–µ –∫–∞–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
      function log(message, type = "info") {
        const div = document.createElement("div");
        div.className = `log ${type}`;
        div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
        document.getElementById("log").appendChild(div);
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      // Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
      const firebaseConfig = {
        apiKey: "AIzaSyAiB6veVSOVDVz5Nx8xZ9Eb_6dEp7JUTBo",
        authDomain: "budgetami.firebaseapp.com",
        databaseURL:
          "https://budgetami-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "budgetami",
        storageBucket: "budgetami.firebasestorage.app",
        messagingSenderId: "211374589260",
        appId: "1:211374589260:web:1570eb8b1ddd56a8f64eca",
      };

      function checkFirebaseStep1() {
        log("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É Firebase SDK...", "info");

        if (typeof firebase === "undefined") {
          log("‚ùå Firebase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!", "error");
          return false;
        }

        log("‚úÖ Firebase SDK –∑–∞–≥—Ä—É–∂–µ–Ω", "success");
        log(
          `üì¶ Firebase –≤–µ—Ä—Å–∏—è: ${firebase.SDK_VERSION || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}`,
          "info"
        );

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
        const services = [];
        if (firebase.app) services.push("app");
        if (firebase.auth) services.push("auth");
        if (firebase.database) services.push("database");

        log(`üõ†Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã: ${services.join(", ")}`, "info");
        return true;
      }

      function checkFirebaseStep2() {
        log("üîß –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Firebase...", "info");

        if (!checkFirebaseStep1()) return false;

        try {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ª–∏ Firebase
          let app;
          try {
            app = firebase.app();
            log("‚úÖ Firebase —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω", "success");
            log(`üì± App name: ${app.name}`, "info");
          } catch (error) {
            log("üîÑ Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º...", "warning");
            app = firebase.initializeApp(firebaseConfig);
            log("‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!", "success");
            log(`üì± App name: ${app.name}`, "info");
          }

          return true;
        } catch (error) {
          log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, "error");
          return false;
        }
      }

      async function checkFirebaseStep3() {
        log("üåê –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase...", "info");

        if (!checkFirebaseStep2()) return false;

        try {
          // –¢–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
          log("üîê –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–Ω–æ–Ω–∏–º–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é...", "info");
          const auth = firebase.auth();
          await auth.signInAnonymously();
          log(
            `‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! User ID: ${auth.currentUser.uid}`,
            "success"
          );

          // –¢–µ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
          log("üíæ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...", "info");
          const database = firebase.database();
          const testRef = database.ref("debug-test");

          const testData = {
            timestamp: Date.now(),
            message: "Debug test from diagnostic page",
            userAgent: navigator.userAgent.substring(0, 50),
          };

          await testRef.set(testData);
          log("‚úÖ –ó–∞–ø–∏—Å—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–∞", "success");

          // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è
          const snapshot = await testRef.once("value");
          const readData = snapshot.val();

          if (readData && readData.timestamp === testData.timestamp) {
            log("‚úÖ –ß—Ç–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ", "success");
          } else {
            log("‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏", "error");
          }

          // –û—á–∏—Å—Ç–∫–∞
          await testRef.remove();
          log("üßπ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã", "info");

          return true;
        } catch (error) {
          log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, "error");
          log(`‚ùå Error code: ${error.code || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}`, "error");
          return false;
        }
      }

      async function runFullTest() {
        log("üöÄ === –ó–ê–ü–£–°–ö –ü–û–õ–ù–û–ì–û –¢–ï–°–¢–ê ===", "info");
        document.getElementById("log").innerHTML = "";

        const step1 = checkFirebaseStep1();
        if (!step1) {
          log("üõë –¢–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —à–∞–≥–µ 1", "error");
          return;
        }

        await new Promise((resolve) => setTimeout(resolve, 500));

        const step2 = checkFirebaseStep2();
        if (!step2) {
          log("üõë –¢–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —à–∞–≥–µ 2", "error");
          return;
        }

        await new Promise((resolve) => setTimeout(resolve, 500));

        const step3 = await checkFirebaseStep3();
        if (!step3) {
          log("üõë –¢–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —à–∞–≥–µ 3", "error");
          return;
        }

        log("üéâ === –í–°–ï –¢–ï–°–¢–´ –ü–†–û–®–õ–ò –£–°–ü–ï–®–ù–û! ===", "success");
        log(
          "‚úÖ Firebase –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é",
          "success"
        );
      }

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      window.addEventListener("load", () => {
        setTimeout(() => {
          log("üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Firebase...", "info");
          checkFirebaseStep1();
        }, 1000);
      });
    </script>
  </body>
</html>
